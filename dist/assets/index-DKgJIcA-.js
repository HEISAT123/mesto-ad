(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function o(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(r){if(r.ep)return;r.ep=!0;const c=o(r);fetch(r.href,c)}})();const l={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"dbeb5f55-3590-4d6f-8726-ff5e28550547","Content-Type":"application/json"}},u=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),$=()=>fetch(`${l.baseUrl}/users/me`,{headers:l.headers}).then(u),F=()=>fetch(`${l.baseUrl}/cards`,{headers:l.headers}).then(u),X=({name:e,about:t})=>fetch(`${l.baseUrl}/users/me`,{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e,about:t})}).then(u),Y=e=>fetch(`${l.baseUrl}/users/me/avatar`,{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:e})}).then(u),Z=({name:e,link:t})=>fetch(`${l.baseUrl}/cards`,{method:"POST",headers:l.headers,body:JSON.stringify({name:e,link:t})}).then(u),ee=e=>fetch(`${l.baseUrl}/cards/${e}`,{method:"DELETE",headers:l.headers}).then(u),te=(e,t)=>fetch(`${l.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:l.headers}).then(o=>u(o)),oe=e=>{e.classList.toggle("card__like-button_is-active")},ne=e=>{e.remove()},re=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),N=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:n,onInfoClick:r})=>{const c=re(),s=c.querySelector(".card__like-button"),_=c.querySelector(".card__control-button_type_delete"),d=c.querySelector(".card__image"),Q=c.querySelector(".card__control-button_type_info");return d.src=e.link,d.alt=e.name,c.querySelector(".card__title").textContent=e.name,o&&s.addEventListener("click",()=>o(s)),n&&_.addEventListener("click",()=>n(c)),t&&d.addEventListener("click",()=>t({name:e.name,link:e.link})),r&&Q.addEventListener("click",r),c},O=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");a(t)}},p=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",O)},a=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",O)},ce=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{a(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&a(e)})},se=(e,t,o)=>{const n=document.getElementById(`${e.id}-error`);e.validity.patternMismatch?n.textContent=e.dataset.errorMessage:n.textContent=e.validationMessage,n.classList.add(o),e.classList.add(t)},D=(e,t,o)=>{const n=document.getElementById(`${e.id}-error`);n.textContent="",n.classList.remove(o),e.classList.remove(t)},le=e=>e.some(t=>!t.validity.valid),ie=(e,t,o)=>{e.validity.valid?D(e,t,o):se(e,t,o)},ae=(e,t)=>{e.classList.remove(t),e.disabled=!1},W=(e,t)=>{e.classList.add(t),e.disabled=!0},M=(e,t,o)=>{le(e)?W(t,o):ae(t,o)},ue=(e,t,o,n,r,c)=>{const s=Array.from(e.querySelectorAll(t)),_=e.querySelector(o);M(s,_,n),s.forEach(d=>{d.addEventListener("input",()=>{ie(d,r,c),M(s,_,n)})})},g=(e,t)=>{const o=t,n=Array.from(e.querySelectorAll(o.inputSelector)),r=e.querySelector(o.submitButtonSelector);n.forEach(c=>{D(c,o.inputErrorClass,o.errorClass)}),W(r,o.inactiveButtonClass)},de=e=>{const t=e;Array.from(document.querySelectorAll(t.formSelector)).forEach(n=>{ue(n,t.inputSelector,t.submitButtonSelector,t.inactiveButtonClass,t.inputErrorClass,t.errorClass)})},R=document.querySelector(".places__list"),L=document.querySelector(".popup_type_edit"),v=L.querySelector(".popup__form"),H=v.querySelector(".popup__input_type_name"),j=v.querySelector(".popup__input_type_description"),q=document.querySelector(".popup_type_new-card"),m=q.querySelector(".popup__form"),pe=m.querySelector(".popup__input_type_card-name"),me=m.querySelector(".popup__input_type_url"),C=document.querySelector(".popup_type_image"),T=C.querySelector(".popup__image"),_e=C.querySelector(".popup__caption"),fe=document.querySelector(".profile__edit-button"),ye=document.querySelector(".profile__add-button"),k=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),I=document.querySelector(".profile__image"),x=document.querySelector(".popup_type_edit-avatar"),S=x.querySelector(".popup__form"),w=S.querySelector(".popup__input"),P=document.querySelector(".popup_type_info"),U=P.querySelector(".popup__info"),A=P.querySelector(".popup__list"),B=document.querySelector(".popup_type_remove-card"),he=B.querySelector(".popup__form");let y=null,h=null;const Se=await $(),ve=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),i=(e,t,o)=>{t?(e.textContent="Сохранение...",e.disabled=!0):(e.textContent=o,e.disabled=!1)},J=({name:e,link:t})=>{T.src=t,T.alt=e,_e.textContent=e,p(C)},be=e=>{e.preventDefault();const t=e.submitter,o=t.textContent;i(t,!0,o),X({name:H.value,about:j.value}).then(n=>{k.textContent=n.name,E.textContent=n.about,a(L)}).catch(n=>{console.log(n)}).finally(()=>{i(t,!1,o)})},ge=e=>{e.preventDefault();const t=e.submitter,o=t.textContent;i(t,!0,o),Y(w.value).then(()=>{I.style.backgroundImage=`url(${w.value})`,a(x)}).catch(n=>{console.log(n)}).finally(()=>{i(t,!1,o)})},V=(e,t)=>{ke(e,t)},Le=e=>{e.preventDefault();const t=e.submitter,o=t.textContent;i(t,!0,o),y&&h&&ee(y).then(()=>{ne(h),a(B),y=null,h=null}).catch(n=>{console.log(n)}).finally(()=>{i(t,!1,o)})},z=(e,t)=>t.likes.some(o=>e._id===o._id),K=(e,t,o)=>{const n=z(e,t);te(t._id,n).then(r=>{t.likes=r.likes;const c=o.nextElementSibling;c.textContent=t.likes.length,oe(o)}).catch(r=>{console.log(r)})},qe=e=>{e.preventDefault();const t=e.submitter,o=t.textContent;i(t,!0,o),Z({name:pe.value,link:me.value}).then(n=>{R.prepend(N(n,{onPreviewPicture:J,onLikeIcon:r=>K(Se,n,r),onDeleteCard:r=>V(n._id,r),onInfoClick:()=>G(n._id)})),a(q)}).catch(n=>{console.log(n)}).finally(()=>{i(t,!1,o)})},f=(e,t)=>{const n=document.querySelector("#popup-info-definition-template").content.querySelector(".popup__info-item").cloneNode(!0);return n.querySelector(".popup__info-term").textContent=e,n.querySelector(".popup__info-description").textContent=t,n},Ce=e=>{const o=document.querySelector("#popup-info-user-preview-template").content.querySelector(".popup__list-item").cloneNode(!0);return o.textContent=e.name,o},G=e=>{F().then(t=>{const o=t.find(n=>n._id===e);if(!o){console.error("Карточка не найдена");return}U.innerHTML="",A.innerHTML="",U.append(f("Описание:",o.name),f("Дата создания:",ve(new Date(o.createdAt))),f("Владелец:",o.owner.name),f("Количество лайков:",o.likes.length)),o.likes.forEach(n=>{A.append(Ce(n))}),p(P)}).catch(t=>{console.log(t)})};v.addEventListener("submit",be);m.addEventListener("submit",qe);S.addEventListener("submit",ge);he.addEventListener("submit",Le);fe.addEventListener("click",()=>{H.value=k.textContent,j.value=E.textContent,g(v,b),p(L)});I.addEventListener("click",()=>{S.reset(),g(S,b),p(x)});ye.addEventListener("click",()=>{m.reset(),g(m,b),p(q)});const ke=(e,t)=>{y=e,h=t,p(B)},Ee=document.querySelectorAll(".popup");Ee.forEach(e=>{ce(e)});const b={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};de(b);Promise.all([F(),$()]).then(([e,t])=>{k.textContent=t.name,E.textContent=t.about,I.style.backgroundImage=`url(${t.avatar})`,e.forEach(o=>{const n=N({name:o.name,link:o.link},{onPreviewPicture:J,onLikeIcon:s=>K(t,o,s),onDeleteCard:s=>V(o._id,s),onInfoClick:()=>G(o._id)});if(t._id!==o.owner._id){const s=n.querySelector(".card__control-button_type_delete");s.style.display="none"}const r=n.querySelector(".card__like-button");z(t,o)&&r.classList.add("card__like-button_is-active");const c=n.querySelector(".card__like-count");c.textContent=o.likes.length,R.prepend(n)})}).catch(e=>{console.log(e)});
